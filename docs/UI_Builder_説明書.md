# UI Builder 説明書

## これは何？

**UI Builder** は、「要件」と「デザインルール」をインプットに、AIとの対話でプロダクトのUI画面を生成し、そのままFigmaに反映できるツールです。

画面作成のたびに**タスクフォルダ**が作られ、要件書（インプット）と生成HTML（アウトプット）がセットで管理されます。

---

## 何ができるの？

### 1. 要件からUI画面を生成する

要件テキスト（何の画面を、どんな構成で作るか）をインプットとして渡すと、プロダクトのデザインルール（カラー・フォント・レイアウト）に準拠した**単一HTMLファイル**が生成されます。

```
「ホーム画面を作って。上部にバナー、中段にギフトカードの一覧、下部にナビゲーション」
```

- デザイントークン（色・フォント・間隔）に自動で準拠
- モバイル画面もデスクトップ管理画面もテンプレートから生成
- 要件を追加していけば何度でもブラッシュアップ可能

### 2. FigmaのデザインをベースにUI作成

Figmaに既存のデザインがあれば、それを読み込んでHTMLに変換できます。

```
「Figmaのこのデザインをベースにして」
```

- Figma Dev Mode MCP でデザイン情報を直接取得
- 既存デザインからの派生・バリエーション作成が簡単

### 3. 生成したUIをFigmaに自動反映

作ったHTMLをFigmaのファイルに図形としてキャプチャします。

- 生成後に自動でFigmaに反映（手動コピペ不要）
- 既存のFigmaファイルにページとして追加される
- Figma上で手調整・プロトタイプ接続がそのままできる

### 4. 複数プロダクトに対応

テンプレートから新しいプロダクト用のUI Builderをワンコマンドで作成できます。

```bash
./create-product --dir my-product --name "My Product"
```

---

## 何が便利？

| 従来の方法 | UI Builderを使うと |
|:---|:---|
| Figmaで1画面ずつ手作業で作成 | 要件を書けばAIが画面を生成 |
| デザイントークンを毎回手動で適用 | 自動でカラー・フォント・レイアウトが適用される |
| HTMLプロトタイプとFigmaが別管理 | 生成→Figma反映が一気通貫 |
| デザイナー不在だと画面案が作れない | PMやエンジニアだけでUIの叩き台が作れる |
| 要件と成果物がバラバラに散らばる | タスクフォルダで要件書とHTMLがセット管理される |

**特にこんな場面で威力を発揮します：**

- 企画段階でUI案をさっと形にしたい
- 商談・提案用のプロトタイプを素早く準備したい
- 既存デザインのバリエーションをたくさん試したい
- デザイナーに依頼する前に、自分でイメージを具体化したい

---

## ワークフロー全体像

```
0. 事前準備（初回のみ）    デザイントークンとデザインルールを整備
       ↓
1. 要件をインプット        要件書 or 対話で「何の画面を作るか」を定義
       ↓
2. Figma読み込み（任意）    既存デザインをベースにする場合
       ↓
3. HTML生成               Claude Codeで対話的にUI作成 → task/に保存
       ↓
4. Figmaにキャプチャ       自動でFigmaファイルに反映
       ↓
5. プロトタイプ作成         Figma上でフレームを接続
```

- ステップ1〜4はClaude Code上で完結
- ステップ5はFigmaで手動操作（画面遷移の接続など）
- フィードバックがあればステップ1に戻り、要件書を追記してUIを更新

---

## タスクフォルダの構造

画面作成のたびに**タスクフォルダ**が自動作成され、インプット（要件）とアウトプット（HTML）がセットで管理されます。

```
task/
└── 260218_ホーム画面刷新/          ← 1つの画面作成タスク
    ├── 01_require/                 ← インプット
    │   └── 260218_ホーム画面刷新.txt  要件書（画面の目的・構成・振る舞い）
    ├── 02_asset/                   ← 参考素材（スクショ、既存UI画像など）
    ├── 03_ui/                      ← アウトプット
    │   ├── home.html                 生成されたHTML（1画面1ファイル）
    │   ├── modal-gift.html           モーダルなどの派生画面
    │   └── ...
    └── figma.json                  ← Figmaキャプチャ履歴（自動生成）
```

| フォルダ | 役割 | 説明 |
|:---|:---|:---|
| `01_require/` | インプット | 要件書テキスト。画面の目的・構成要素・振る舞いなどを記載 |
| `02_asset/` | 参考素材 | 参考スクショ、既存UI画像、手描きスケッチなど |
| `03_ui/` | アウトプット | AIが生成した単一HTMLファイル |
| `figma.json` | キャプチャ記録 | FigmaファイルキーとキャプチャURL履歴 |

**ポイント**: 追加の要望やフィードバックがあった場合、UIの修正と同時に `01_require/` の要件書にも日付付きで追記します。こうすることで、後から「なぜこのUIになったか」の経緯を追えます。

---

## セットアップ手順

### Step 0: 前提条件の確認

以下のツールが必要です。

| ツール | 用途 | インストール |
|:---|:---|:---|
| **Claude Code** or **Codex CLI** | AIとの対話・HTML生成 | [Claude Code公式](https://docs.anthropic.com/en/docs/claude-code) |
| **Google Chrome** | Figmaキャプチャ時にページを表示 | [ダウンロード](https://www.google.com/chrome/) |
| **Figma Desktop App** | Dev Mode MCPでのデザイン読み取り | [ダウンロード](https://www.figma.com/downloads/) |
| **Python 3** | HTTPサーバー・スクリプト実行 | macOSなら標準搭載 |

### Step 1: リポジトリをclone

```bash
git clone https://github.com/itsukimastumoto/ui_builder.git
cd ui_builder
```

### Step 2: 環境チェック

```bash
./doctor
```

必要なツールが揃っているか自動チェックされます。`ERR` が出たら該当ツールをインストールしてください。

### Step 3: MCP（Model Context Protocol）の設定

Figma連携に2つのMCPサーバーを設定します。

**Claude Codeの場合** — プロジェクトルートに `.mcp.json` を作成：

```json
{
  "mcpServers": {
    "figma-dev-mode-mcp-server": {
      "url": "http://127.0.0.1:3845/sse"
    },
    "figma-remote-mcp": {
      "url": "https://mcp.figma.com/mcp"
    }
  }
}
```

**Codex CLIの場合** — `~/.codex/config.toml` に追記：

```toml
[mcpServers.figma-dev-mode-mcp-server]
type = "sse"
url = "http://127.0.0.1:3845/sse"

[mcpServers.figma-remote-mcp]
type = "sse"
url = "https://mcp.figma.com/mcp"
```

| サーバー | 役割 | 補足 |
|:---|:---|:---|
| `figma-dev-mode-mcp-server` | Figma → AI（デザイン読み取り） | Figma DesktopでDev Mode MCPを有効にすると自動起動 |
| `figma-remote-mcp` | AI → Figma（キャプチャ書き込み） | 初回接続時にブラウザでFigmaアカウントのOAuth認証が必要 |

### Step 4: プロダクトフォルダの作成

```bash
./create-product --dir my-product --name "My Product"
```

以下のフォルダが自動作成されます：

```
my-product/
├── run                    # バッチ生成スクリプト
├── AGENTS.md / CLAUDE.md  # AIへのデザインルール・作業指示
├── assets/
│   └── design-tokens.css  # デザイントークン（★要編集）
├── templates/             # 参照用HTMLテンプレート
└── task/                  # タスクフォルダ（要件+生成物のセット管理）
```

### Step 5: デザイントークンの設定

`my-product/assets/design-tokens.css` を開いて、プロダクトのカラーパレットやフォントを設定します。

```css
:root {
  /* ここをプロダクトの色に変更 */
  --color-primary: #0C6993;
  --color-primary-dark: #0F658D;
  --color-text: #4E5B61;
  --color-background: #F0F0F0;
  /* ... */
}
```

ここで設定した値が、AIの生成するHTMLに自動適用されます。

### Step 6: デザインルールの設定

`my-product/AGENTS.md` と `CLAUDE.md` に、プロダクト固有のデザインルールを記載します。

- 画面タイプ（モバイル/デスクトップ/管理画面）
- レイアウトの基本構成（ヘッダー、ナビゲーション、コンテンツ領域）
- ブランドガイドライン（製品名ルール、色使いの注意点）
- Figmaファイルの参照情報（ファイルキー等）

これらのファイルはClaude Codeが起動時に自動で読み込み、AIがデザインルールとして参照します。

### セットアップ完了！

これで準備は完了です。

---

## 使い方

### 使い方A: Claude Codeで対話的に作成（メイン）

最も簡単で推奨される使い方です。

```bash
cd my-product
claude   # Claude Code を起動
```

Claude Codeが起動したら、自然言語で指示するだけです。AIがAGENTS.mdのルールとデザイントークンを自動で参照し、タスクフォルダの作成からHTML生成、Figmaキャプチャまでを実行します。

**画面作成の指示例：**

```
ホーム画面を作って。上部にロゴとベルアイコン、中段にバナーとギフト一覧、下にナビゲーション。
```

```
ログイン画面を作って。メールアドレスとパスワードのフォーム、ログインボタン、パスワードを忘れた方リンク。
```

```
管理画面のユーザー一覧を作って。テーブル形式で、名前・メール・ステータスの列。検索バーとCSVエクスポートボタン付き。
```

**作成されるタスクフォルダ：**

```
task/260218_ホーム/
├── 01_require/260218_ホーム.txt    ← 要件が自動記録される
├── 02_asset/
└── 03_ui/home.html                ← 生成されたHTML
```

**Figma読み込みの指示例：**

```
Figmaのこのデザインをベースにホーム画面を作って。
```

**修正・ブラッシュアップの指示例：**

```
ボタンの色をもっと目立つようにして。
```

```
A案とB案の2パターン作って。A案はカード型レイアウト、B案はリスト型レイアウト。
```

AIがHTMLを生成した後、自動でFigmaにキャプチャされます。キャプチャが不要な場合は「Figmaに反映しなくていい」と伝えてください。

### 使い方B: runスクリプトでバッチ生成（サブ）

コマンド一発でHTMLを生成する方法です。Figma連携は含まれません。

```bash
./run --requirements "ホーム画面を作成。バナー、ギフト一覧、ナビゲーション付き" --title "ホーム"
```

| オプション | 説明 |
|:---|:---|
| `--requirements` | 画面の要件（必須） |
| `--title` | タスクフォルダの名前（省略可） |
| `--output` | 出力ファイル名（省略可） |

タスクフォルダが自動作成され、要件書が `01_require/` に、生成HTMLが `03_ui/` に保存されます。

---

## Figma画面整理プラグイン（おまけ）

キャプチャが増えてきたら、Figma上のフレームをカテゴリ別に自動整理するプラグインも同梱しています。

**インストール方法：**

1. Figma Desktop App を開く
2. Plugins → Development → "Import plugin from manifest..." を選択
3. `figma-plugin/manifest.json` を指定
4. プラグイン一覧に追加されたらOK

**使い方：**
Plugins → Development から実行すると、画面名からカテゴリを判定してセクション分けしてくれます。

---

## ディレクトリ構成

```
ui_builder/
├── README.md              # 技術的なリファレンス
├── doctor                 # 環境チェックスクリプト
├── create-product         # 新規プロダクト作成スクリプト
├── figma-capture          # Figmaキャプチャヘルパー（共通）
├── figma-plugin/          # Figma画面整理プラグイン（共通）
├── template/              # 新規プロダクト用テンプレート
└── oasis/                 # giftee Benefit の実運用例（参考実装）
    └── task/              # 実際のタスクフォルダ群
        ├── 260123_ホーム画面刷新/
        │   ├── 01_require/   要件書
        │   ├── 02_asset/     参考素材
        │   └── 03_ui/        生成HTML
        ├── 260209_ギフト中心ホーム/
        └── ...
```

---

## よくある質問

### Q. デザイナーじゃなくても使える？

はい。PMやエンジニアが企画段階でUI案を形にすることを想定しています。デザイントークンとデザインルール（AGENTS.md）を事前に設定しておけば、AIが自動でデザインルールに準拠した画面を生成します。

### Q. 生成されたHTMLはそのまま本番で使える？

いいえ。あくまでワイヤーフレーム/プロトタイプ用途です。Figmaに取り込んだ後、デザイナーが手調整してからの実装を想定しています。

### Q. Figmaなしでも使える？

はい。HTML生成だけならFigma不要です。ただし、Figmaへのキャプチャ（自動反映）やFigmaからのデザイン読み込みにはFigma + MCP設定が必要です。

### Q. 既存のプロダクトのデザインルールはどうやって適用するの？

2つのファイルで設定します：
- `assets/design-tokens.css` — カラーパレット・フォント・スペーシングの定義
- `AGENTS.md` / `CLAUDE.md` — 画面タイプ、レイアウト構成、ブランドルール等

設定後は、AIがこれらを自動参照してHTML生成に反映します。

### Q. 要件書は必ず書かないとダメ？

対話モードでは口頭指示だけでも動きます。ただし、要件書を `01_require/` に事前に書いておくと、AIが意図通りの画面を生成しやすくなります。複雑な画面ほど要件書の効果が大きいです。

### Q. 1回の指示でどのくらいの画面ができる？

1回の指示で1画面が基本です。「A案とB案を作って」のように複数バリエーションも対応可能です。

### Q. macOS以外でも使える？

HTML生成はOS問わず動作します。ただし、FigmaキャプチャのChrome操作部分はmacOS（AppleScript）に依存しています。

---

## まとめ

| | |
|:---|:---|
| **一言で言うと** | 要件とデザインルールをもとに、AIがUI画面を生成してFigmaに反映するツール |
| **インプット** | 要件書（`01_require/`） + デザイントークン（`assets/design-tokens.css`） |
| **アウトプット** | 単一HTMLファイル（`03_ui/`） + Figmaキャプチャ |
| **誰が使う？** | PM、エンジニア、デザイナー |
| **何が必要？** | Claude Code + Chrome + Figma + Python 3 |
| **セットアップ時間** | 約10分 |
| **メインの使い方** | Claude Codeで対話的に指示 |
